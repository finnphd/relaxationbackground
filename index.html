<!DOCTYPE html>
<html>
<head>
    <title>Audio Player with Background Noise</title>
</head>
<body>
    <svg id="play" viewBox="0 0 200 200" style="margin: auto; width: 90vw; height: 90vh">
        <circle cx="100" cy="100" r="100" />
        <polygon fill="#FFFFFF" points="146.5,100 71.5,56.7 71.5,143.3" />
    </svg>

    <div id="noise-selector">
        <button id="play-white-noise">Play White Noise</button>
        <button id="play-pink-noise">Play Pink Noise</button>
        <button id="play-brownian-noise">Play Brownian Noise</button>
    </div>

    <script>
        // Existing code for audio playback
        if (typeof Audio !== "undefined") {
            const audioObj = new Audio("./Responsive Hypnosis Example.mp3");
            const playButton = document.getElementById('play');

            // ... (Existing code for audio playback)

            audioObj.addEventListener('error', function () {
                console.error('Audio could not be loaded.');
            });

            // Function to generate background noise
            function generateNoise(type) {
                const context = new (window.AudioContext || window.webkitAudioContext)();

                // Create a noise source node
                const noiseNode = context.createBufferSource();
                noiseNode.loop = true;

                // Create a buffer to store the noise data
                const bufferSize = context.sampleRate * 2;
                const buffer = context.createBuffer(1, bufferSize, context.sampleRate);
                const data = buffer.getChannelData(0);

                // Generate noise data based on the selected type
                for (let i = 0; i < bufferSize; i++) {
                    if (type === 'white') {
                        data[i] = Math.random() * 2 - 1;
                    } else if (type === 'pink') {
                        // Implement pink noise generation here
                        data[i] = /* Pink noise generation */;
                    } else if (type === 'brownian') {
                        // Implement brownian noise generation here
                        data[i] = /* Brownian noise generation */;
                    }
                }

                noiseNode.buffer = buffer;
                noiseNode.connect(context.destination);
                noiseNode.start();

                // Store a reference to the noise node to stop it later
                const noiseNodes = {
                    [type]: noiseNode,
                };

                return noiseNodes;
            }

            // Event listeners for noise buttons
            const noiseNodes = {}; // To store noise nodes

            const whiteNoiseButton = document.getElementById('play-white-noise');
            whiteNoiseButton.addEventListener('click', () => {
                stopNoise('white');
                noiseNodes.white = generateNoise('white');
            });

            const pinkNoiseButton = document.getElementById('play-pink-noise');
            pinkNoiseButton.addEventListener('click', () => {
                stopNoise('pink');
                noiseNodes.pink = generateNoise('pink');
            });

            const brownianNoiseButton = document.getElementById('play-brownian-noise');
            brownianNoiseButton.addEventListener('click', () => {
                stopNoise('brownian');
                noiseNodes.brownian = generateNoise('brownian');
            });

            // Function to stop noise playback
            function stopNoise(type) {
                if (noiseNodes[type]) {
                    noiseNodes[type].stop();
                }
            }
        } else {
            console.error("Audio is not supported in this browser.");
        }
    </script>
</body>
</html>
